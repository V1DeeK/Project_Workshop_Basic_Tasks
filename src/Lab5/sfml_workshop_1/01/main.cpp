// Подключаем библиотеку SFML для работы с графикой
#include <SFML/Graphics.hpp>
// Подключаем библиотеку для работы со временем
#include <SFML/System.hpp>
// Подключаем библиотеку для математических функций
#include <cmath>

// Главная функция программы
int main()
{
    // === СОЗДАНИЕ ОКНА ===
    // Создаем окно для отображения графики
    // sf::RenderWindow - класс для создания и управления окном
    // sf::VideoMode({800, 600}) - размер окна: ширина 800, высота 600
    // "Rotating Square" - заголовок окна
    sf::RenderWindow window(sf::VideoMode({800, 600}), "Rotating Square");
    
    // === СОЗДАНИЕ КВАДРАТА ===
    // Создаем квадрат
    // sf::RectangleShape - класс для рисования прямоугольников
    // sf::Vector2f(100, 100) - размер: ширина 100, высота 100 пикселей
    sf::RectangleShape square(sf::Vector2f(100, 100));
    // Устанавливаем цвет заливки квадрата - синий
    square.setFillColor(sf::Color::Blue);
    
    // Устанавливаем точку origin для квадрата
    // origin - точка, относительно которой происходит поворот
    // По умолчанию origin = (0, 0) - левый верхний угол
    // Мы устанавливаем origin в центр квадрата для вращения вокруг центра
    // setOrigin({x, y}) - устанавливает точку origin
    // 50, 50 - центр квадрата (ширина/2, высота/2)
    square.setOrigin({50, 50});
    
    // Устанавливаем начальную позицию квадрата в центре окна
    // setPosition({x, y}) - устанавливает координаты фигуры
    // 400, 300 - центр окна (800/2, 600/2)
    square.setPosition({400, 300});
    
    // === ПЕРЕМЕННЫЕ ДЛЯ АНИМАЦИИ ===
    // Угол поворота квадрата в градусах
    // float - число с плавающей точкой
    // 0 - начальный угол (квадрат не повернут)
    float rotation = 0.0f;
    
    // Скорость вращения в градусах в секунду
    // 90 - квадрат будет поворачиваться на 90 градусов в секунду
    const float rotationSpeed = 90.0f;
    
    // === ОСНОВНОЙ ЦИКЛ ПРОГРАММЫ (GAME LOOP) ===
    // Создаем часы для измерения времени между кадрами
    // sf::Clock - класс для измерения времени
    sf::Clock clock;
    
    // Цикл работает, пока окно открыто
    while (window.isOpen())
    {
        // === ИЗМЕРЕНИЕ ВРЕМЕНИ ===
        // Получаем время, прошедшее с последнего кадра
        // clock.restart() - перезапускает часы и возвращает прошедшее время
        // asSeconds() - преобразует время в секунды (float)
        // deltaTime - время между кадрами в секундах
        float deltaTime = clock.restart().asSeconds();
        
        // === ЭТАП 1: ОБРАБОТКА СОБЫТИЙ ===
        // Цикл обработки всех событий из очереди
        // window.pollEvent() - извлекает событие из очереди (SFML 3 API)
        while (auto event = window.pollEvent())
        {
            // Проверяем, является ли событие закрытием окна
            if (event->is<sf::Event::Closed>())
            {
                // Закрываем окно, если пользователь нажал на крестик
                window.close();
            }
        }
        
        // === ЭТАП 2: ОБНОВЛЕНИЕ СОСТОЯНИЯ (АНИМАЦИЯ) ===
        // Обновляем угол поворота квадрата
        // Формула: новый_угол = старый_угол + скорость_вращения * время
        // Это позволяет квадрату вращаться с постоянной скоростью независимо от FPS
        rotation += rotationSpeed * deltaTime;
        
        // Нормализуем угол (оставляем в диапазоне 0-360 градусов)
        // fmod() - функция остатка от деления для чисел с плавающей точкой
        // Если угол стал больше 360, возвращаем его в диапазон 0-360
        // Это не обязательно, но помогает избежать переполнения
        if (rotation >= 360.0f)
        {
            rotation -= 360.0f;
        }
        
        // Устанавливаем новый угол поворота квадрата
        // setRotation() - устанавливает угол поворота в градусах
        // rotation - текущий угол поворота
        square.setRotation(rotation);
        
        // === ЭТАП 3: ОТРИСОВКА ===
        // Очищаем окно белым цветом перед отрисовкой нового кадра
        // window.clear() - заполняет все окно указанным цветом
        window.clear(sf::Color::White);
        
        // Рисуем квадрат на окне
        // window.draw() - добавляет фигуру в буфер отрисовки
        window.draw(square);
        
        // Отображаем все нарисованное на экране
        // window.display() - выводит содержимое буфера на экран
        window.display();
    }
    
    // Возвращаем 0 - код успешного завершения программы
    return 0;
}

